<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writing - Part 3</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="icon" href="img/favicon.png" type="image/x-icon">
</head>
<body>
    <header id="header-placeholder"></header>
    <div class="content-pusher">
        <div class="container">
            <div class="page-intro">
                <h1>Writing - Part 3</h1>
                <p>Tr√≤ chuy·ªán trong Chat Room (T·ªïng th·ªùi gian: 10 ph√∫t)</p>
            </div>
            <!-- TH√äM C·∫®M NANG V√ÄO ƒê√ÇY -->
            <div class="explanation-box">
                <h3>üí° C·∫©m nang tr·∫£ l·ªùi Part 3</h3>
                <p>B·∫°n c√≥ <strong>10 ph√∫t</strong> ƒë·ªÉ tr·∫£ l·ªùi 3 c√¢u h·ªèi t·ª´ 3 ng∆∞·ªùi kh√°c nhau trong m·ªôt ph√≤ng chat. ƒê√¢y l√† ph·∫ßn thi ki·ªÉm tra kh·∫£ nƒÉng giao ti·∫øp th√¢n m·∫≠t, t·ª± nhi√™n.</p>
                <ul>
                    <li><strong>M·ª•c ti√™u s·ªë t·ª´:</strong> Vi·∫øt kho·∫£ng <strong>30 - 40 t·ª´</strong> cho m·ªói c√¢u tr·∫£ l·ªùi.</li>
                    <li><strong>VƒÉn phong:</strong> S·ª≠ d·ª•ng ng√¥n ng·ªØ kh√¥ng trang tr·ªçng (informal), gi·ªëng nh∆∞ khi b·∫°n ƒëang nh·∫Øn tin v·ªõi b·∫°n b√®. C√≥ th·ªÉ d√πng c√°c c√¢u c·∫£m th√°n ng·∫Øn (Wow!, That's cool!).</li>
                    <li><strong>Chi·∫øn l∆∞·ª£c:</strong> Tr·∫£ l·ªùi tr·ª±c ti·∫øp v√†o c√¢u h·ªèi v√† c√≥ th·ªÉ th√™m m·ªôt chi ti·∫øt nh·ªè ho·∫∑c m·ªôt c√¢u h·ªèi ng∆∞·ª£c l·∫°i ƒë·ªÉ cu·ªôc tr√≤ chuy·ªán t·ª± nhi√™n h∆°n.
                        <ul>
                             <li><strong>V√≠ d·ª•:</strong> V·ªõi c√¢u h·ªèi "Do you prefer to eat out or eat at home?", b·∫°n c√≥ th·ªÉ tr·∫£ l·ªùi: "I enjoy eating out with friends whenever possible. It's a great way to socialize and try new dishes. How about you?".</li>
                        </ul>
                    </li>
                    <li><strong>Qu·∫£n l√Ω th·ªùi gian:</strong> D√†nh kho·∫£ng 3 ph√∫t cho m·ªói c√¢u tr·∫£ l·ªùi ƒë·ªÉ ƒë·∫£m b·∫£o b·∫°n ho√†n th√†nh c·∫£ 3 c√¢u.</li>
                </ul>
            </div>
            <div id="topic-selector-grid" class="topic-grid">
                <!-- C√°c n√∫t ch·ªçn ch·ªß ƒë·ªÅ -->
            </div>

            <main id="writing-container">
                <!-- Ch·ªâ m·ªôt b√†i t·∫≠p ƒë∆∞·ª£c hi·ªÉn th·ªã -->
            </main>
        </div>
        <footer id="footer-placeholder"></footer>
    </div>
    <script src="js/main.js"></script>
    <script src="js/data-writing-part3.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const selectorContainer = document.getElementById('topic-selector-grid');
            const contentContainer = document.getElementById('writing-container');
            const topics = writingPart3Data;
            let activeTimerInterval;

            topics.forEach((topic, index) => {
                const button = document.createElement('button');
                button.className = 'topic-selector-btn';
                button.textContent = `Ch·ªß ƒë·ªÅ ${index + 1}`;
                button.dataset.target = `#${topic.id}`;
                selectorContainer.appendChild(button);

                const card = document.createElement('div');
                card.className = 'quiz-card writing-card chat-room';
                card.id = topic.id;
                
                let promptsHTML = '';
                topic.prompts.forEach((prompt, i) => {
                    promptsHTML += `
                        <div class="chat-message them">
                            <div class="chat-user">${prompt.user}</div>
                            <div class="chat-bubble">${prompt.question}</div>
                        </div>
                        <div class="chat-message me">
                            <textarea class="chat-input" rows="3" data-index="${i}" placeholder="Your answer (30-40 words)..."></textarea>
                            <div class="word-count-container"><span class="word-count">0 words</span></div>
                        </div>
                    `;
                });

                card.innerHTML = `
                    <div class="card-header"><h2>${topic.title}</h2></div>
                    <div class="writing-timer-bar">
                        <button class="action-btn start-writing-btn">B·∫Øt ƒë·∫ßu t√≠nh gi·ªù (10 ph√∫t)</button>
                        <div class="timer-display">10:00</div>
                    </div>
                    <div class="chat-window">${promptsHTML}</div>
                    <div class="card-actions">
                        <button class="action-btn show-sample-btn">üìñ Xem c√¢u tr·∫£ l·ªùi m·∫´u</button>
                    </div>
                    <div class="sample-answer-wrapper" style="display: none;"></div>
                `;
                contentContainer.appendChild(card);
            });

            // --- LOGIC (T√°i s·ª≠ d·ª•ng t·ª´ c√°c ph·∫ßn tr∆∞·ªõc, t√πy ch·ªânh) ---
            const allButtons = selectorContainer.querySelectorAll('.topic-selector-btn');
            const allCards = contentContainer.querySelectorAll('.writing-card');
            
            function showTopic(targetId) { /* ... Gi·ªëng Part 1/2 ... */ }
            function loadAnswers(card) { /* ... Gi·ªëng Part 1/2 ... */ }
            allCards.forEach(loadAnswers);
            selectorContainer.addEventListener('click', function(e) { if (e.target.classList.contains('topic-selector-btn')) showTopic(e.target.dataset.target); });
            contentContainer.addEventListener('input', function(e) { /* ... Gi·ªëng Part 1/2 ... */ });
            contentContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('start-writing-btn')) { /* ... Logic timer (10 ph√∫t) ... */ }
                if (e.target.classList.contains('show-sample-btn')) { /* ... Logic show answer (t√πy ch·ªânh) ... */ }
            });
            if (allButtons.length > 0) showTopic(allButtons[0].dataset.target);

            // --- PHI√äN B·∫¢N JAVASCRIPT ƒê·∫¶Y ƒê·ª¶ ---
            function showTopic(targetId) {
                allCards.forEach(card => card.classList.remove('active'));
                allButtons.forEach(btn => btn.classList.remove('active'));
                const targetCard = document.querySelector(targetId);
                const targetButton = selectorContainer.querySelector(`[data-target='${targetId}']`);
                if (targetCard) targetCard.classList.add('active');
                if (targetButton) targetButton.classList.add('active');
                if (activeTimerInterval) clearInterval(activeTimerInterval);
                allCards.forEach(c => {
                    const btn = c.querySelector('.start-writing-btn');
                    const display = c.querySelector('.timer-display');
                    if (btn) btn.disabled = false;
                    if (btn) btn.textContent = 'B·∫Øt ƒë·∫ßu t√≠nh gi·ªù (10 ph√∫t)';
                    if (display) display.textContent = '10:00';
                });
            }
            contentContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('start-writing-btn')) {
                    if (activeTimerInterval) clearInterval(activeTimerInterval);
                    const button = e.target;
                    const timerDisplay = button.nextElementSibling;
                    const card = button.closest('.writing-card');
                    button.disabled = true;
                    button.textContent = 'ƒêang t√≠nh gi·ªù...';
                    let timeInSeconds = 600; // 10 ph√∫t
                    activeTimerInterval = setInterval(() => {
                        timeInSeconds--;
                        const minutes = Math.floor(timeInSeconds / 60);
                        const seconds = timeInSeconds % 60;
                        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        if (timeInSeconds <= 0) {
                            clearInterval(activeTimerInterval);
                            timerDisplay.textContent = "H·∫øt gi·ªù!";
                            alert("H·∫øt gi·ªù l√†m b√†i!");
                            card.querySelectorAll('textarea').forEach(ta => ta.disabled = true);
                        }
                    }, 1000);
                }
                if (e.target.classList.contains('show-sample-btn')) {
                    const wrapper = e.target.closest('.card-actions').nextElementSibling;
                    const card = e.target.closest('.writing-card');
                    const topicData = topics.find(t => t.id === card.id);
                    if (wrapper.innerHTML === '') {
                        topicData.prompts.forEach(p => {
                            wrapper.innerHTML += `<div class="sample-answer"><p><strong>${p.user}:</strong> ${p.sampleAnswer}</p></div>`;
                        });
                    }
                    const isVisible = wrapper.style.display === 'block';
                    wrapper.style.display = isVisible ? 'none' : 'block';
                    e.target.textContent = isVisible ? 'üìñ Xem c√¢u tr·∫£ l·ªùi m·∫´u' : 'üôà ·∫®n c√¢u tr·∫£ l·ªùi m·∫´u';
                }
            });

        });
    </script>
</body>
</html>