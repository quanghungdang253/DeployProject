<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writing - Part 4</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" href="img/favicon.png" type="image/x-icon">
</head>

<body>
    <header id="header-placeholder"></header>
    <div class="content-pusher">
        <div class="container">
            <div class="page-intro">
                <h1>Writing - Part 4</h1>
                <p>Vi·∫øt hai email ph·∫£n h·ªìi</p>
            </div>
            <div class="explanation-box">
                <h3>üí° S∆∞·ªùn b√†i g·ª£i √Ω cho Part 4</h3>
                <p>Writing Part 4 y√™u c·∫ßu b·∫°n vi·∫øt 2 email: m·ªôt cho b·∫°n b√® (th√¢n m·∫≠t) v√† m·ªôt cho qu·∫£n l√Ω (trang tr·ªçng).
                    D∆∞·ªõi ƒë√¢y l√† c√°c s∆∞·ªùn b√†i v√† g·ª£i √Ω ƒë·ªÉ b·∫°n tri·ªÉn khai.</p>

                <!-- S∆∞·ªùn b√†i cho b·∫°n b√® -->
                <div class="method-step">
                    <h4>S∆∞·ªùn b√†i Email cho b·∫°n b√® (Th√¢n m·∫≠t - ~50 t·ª´)</h4>
                    <div class="template-section">
                        <p><strong>1. M·ªü ƒë·∫ßu (Greeting):</strong></p>
                        <ul>
                            <li><code>Hi [T√™n b·∫°n],</code> / <code>Hi Sara,</code></li>
                            <li><code>How's it going?</code> / <code>I hope you‚Äôre doing well.</code></li>
                        </ul>
                        <p><strong>2. N√™u v·∫•n ƒë·ªÅ & C·∫£m x√∫c (Context & Feeling):</strong></p>
                        <ul>
                            <li><code>I just got an email from the club manager. He mentioned that...</code></li>
                            <li><code>To be honest, I was very excited/happy/surprised about this news.</code></li>
                        </ul>
                        <p><strong>3. ƒê∆∞a ra g·ª£i √Ω ch√≠nh (Suggestion):</strong></p>
                        <ul>
                            <li><code>I think we should...</code> / <code>Maybe the club could...</code></li>
                        </ul>
                        <p><strong>4. K·∫øt b√†i (Closing):</strong></p>
                        <ul>
                            <li><code>What do you think?</code> / <code>Let me know your thoughts.</code></li>
                            <li><code>Hope to hear from you soon.</code> / <code>Please reply soon.</code></li>
                            <li><code>Love,</code> / <code>Best,</code> / <code>All the best,</code></li>
                        </ul>
                    </div>
                </div>

                <!-- S∆∞·ªùn b√†i cho qu·∫£n l√Ω -->
                <div class="method-step">
                    <h4>S∆∞·ªùn b√†i Email cho qu·∫£n l√Ω (Trang tr·ªçng - 120-150 t·ª´)</h4>
                    <div class="template-section">
                        <p><strong>1. M·ªü ƒë·∫ßu (Opening):</strong></p>
                        <ul>
                            <li><code>Dear Manager,</code> / <code>Dear Sir/Madam,</code></li>
                            <li><code>I hope this email finds you well.</code></li>
                            <li><strong>Gi·ªõi thi·ªáu b·∫£n th√¢n (quan tr·ªçng):</strong>
                                <code>First, I would like to introduce myself. My name is [T√™n c·ªßa b·∫°n] and I have been a club member for [s·ªë] years.</code>
                            </li>
                            <li><strong>N√™u m·ª•c ƒë√≠ch vi·∫øt th∆∞:</strong>
                                <code>I am writing this email to express my opinion concerning the recent email.</code>
                            </li>
                        </ul>
                        <p><strong>2. Tr√¨nh b√†y l·∫°i v·∫•n ƒë·ªÅ (Context):</strong></p>
                        <ul>
                            <li><code>According to the email, you said that...</code></li>
                            <li><strong>N√™u c·∫£m x√∫c (t√πy ch·ªçn):</strong>
                                <code>To be honest, I was very happy / a little disappointed when I heard this news.</code>
                            </li>
                        </ul>
                        <p><strong>3. Th√¢n b√†i - ƒê∆∞a ra c√°c g·ª£i √Ω (Suggestions):</strong></p>
                        <ul>
                            <li>S·ª≠ d·ª•ng c√°c t·ª´ n·ªëi ƒë·ªÉ tr√¨nh b√†y 2-3 g·ª£i √Ω m·ªôt c√°ch logic:</li>
                            <li><code><strong>From my perspective,</strong> I think we should...</code></li>
                            <li><code><strong>Firstly,</strong> I suggest that the club could...</code></li>
                            <li><code><strong>Secondly,</strong> it would be a great idea if we...</code> /
                                <code><strong>In addition,</strong> we could also...</code> /
                                <code><strong>Besides,</strong> ...</code>
                            </li>
                        </ul>
                        <p><strong>4. K·∫øt b√†i (Closing):</strong></p>
                        <ul>
                            <li><strong>C√°c c√¢u k·∫øt th∆∞ g·ª£i √Ω:</strong>
                                <ul>
                                    <li><code>I have spoken to other club members, and they agree with my suggestions.</code>
                                    </li>
                                    <li><code>Thank you for considering my suggestions. I hope you will find them helpful.</code>
                                    </li>
                                </ul>
                            </li>
                            <li><strong>K√™u g·ªçi h√†nh ƒë·ªông:</strong>
                                <code>I look forward to hearing from you soon.</code>
                            </li>
                            <li><strong>L·ªùi ch√†o cu·ªëi th∆∞:</strong> <code>Yours sincerely,</code> /
                                <code>Best regards,</code>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- TH√äM C·∫®M NANG H∆Ø·ªöNG D·∫™N V√ÄO ƒê√ÇY -->
            <div class="method-guide-card" style="margin-bottom: 30px;">
                <h2>üí° Ph√¢n t√≠ch ƒë·ªÅ & G·ª£i √Ω √Ω t∆∞·ªüng cho Part 4</h2>
                <p>Writing Part 4 th∆∞·ªùng c√≥ hai d·∫°ng ƒë·ªÅ ch√≠nh. Vi·ªác x√°c ƒë·ªãnh ƒë√∫ng d·∫°ng ƒë·ªÅ s·∫Ω gi√∫p b·∫°n c√≥ c·∫•u tr√∫c b√†i
                    vi·∫øt ph√π h·ª£p.</p>

                <div class="method-step">
                    <h4>D·∫°ng 1: L·ª±a ch·ªçn ƒë·ªÅ xu·∫•t (Choose a Proposal)</h4>
                    <p><strong>Nhi·ªám v·ª•:</strong> ƒê·ªÅ b√†i s·∫Ω ƒë∆∞a ra 2 l·ª±a ch·ªçn (v√≠ d·ª•: tr·ªìng c√¢y ·ªü c√¥ng vi√™n HO·∫∂C t·ªï ch·ª©c
                        workshop l√†m v∆∞·ªùn). B·∫°n c·∫ßn ch·ªçn m·ªôt v√† gi·∫£i th√≠ch l√Ω do.</p>
                    <p><strong>Chi·∫øn l∆∞·ª£c g·ª£i √Ω:</strong></p>
                    <ul>
                        <li><strong>Ch·ªçn 1 ƒë·ªÅ xu·∫•t:</strong> R√µ r√†ng b√†y t·ªè s·ª± ·ªßng h·ªô cho l·ª±a ch·ªçn c·ªßa b·∫°n (v√≠ d·ª•: "I
                            strongly support planting 500 trees...").</li>
                        <li><strong>N√™u l√Ω do 1 (∆Øu ƒëi·ªÉm c·ªßa l·ª±a ch·ªçn):</strong> Gi·∫£i th√≠ch t·∫°i sao l·ª±a ch·ªçn c·ªßa b·∫°n l·∫°i
                            t·ªët. (V√≠ d·ª•: "This initiative will provide a greener environment and improve air
                            quality...").</li>
                        <li><strong>N√™u l√Ω do 2 (So s√°nh v·ªõi l·ª±a ch·ªçn c√≤n l·∫°i):</strong> Gi·∫£i th√≠ch t·∫°i sao l·ª±a ch·ªçn c·ªßa
                            b·∫°n t·ªët H∆†N l·ª±a ch·ªçn kia. (V√≠ d·ª•: "While gardening workshops are valuable, I believe more
                            people will benefit from an improved park...").</li>
                    </ul>
                </div>

                <div class="method-step">
                    <h4>D·∫°ng 2: Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ & ƒê∆∞a ra g·ª£i √Ω (Problem-Solving)</h4>
                    <p><strong>Nhi·ªám v·ª•:</strong> ƒê·ªÅ b√†i n√™u ra m·ªôt v·∫•n ƒë·ªÅ ho·∫∑c m·ªôt k·∫ø ho·∫°ch c·∫ßn √Ω ki·∫øn ƒë√≥ng g√≥p (v√≠ d·ª•:
                        l√†m sao ƒë·ªÉ thu h√∫t kh√°ch du l·ªãch?). B·∫°n c·∫ßn ƒë·ªÅ xu·∫•t gi·∫£i ph√°p.</p>
                    <p><strong>Chi·∫øn l∆∞·ª£c g·ª£i √Ω:</strong></p>
                    <ul>
                        <li><strong>ƒê∆∞a ra 2-3 gi·∫£i ph√°p:</strong> C·ªë g·∫Øng ƒë·ªÅ xu·∫•t nh·ªØng √Ω t∆∞·ªüng h·ª£p l√Ω v√† c√≥ t√≠nh
                            thuy·∫øt ph·ª•c ƒë·ªÉ g√¢y ·∫•n t∆∞·ª£ng v·ªõi ng∆∞·ªùi qu·∫£n l√Ω.</li>
                        <li><strong>S·ª≠ d·ª•ng "Ng√¢n h√†ng √Ω t∆∞·ªüng" sau:</strong>
                            <ul>
                                <li><strong>T·ªï ch·ª©c s·ª± ki·ªán:</strong> Ch·ªçn th·ªùi gian/ƒë·ªãa ƒëi·ªÉm, ƒëa d·∫°ng ho·∫°t ƒë·ªông, qu·∫£ng
                                    c√°o...</li>
                                <li><strong>Ch·ªçn ch·ªß ƒë·ªÅ thu h√∫t:</strong> Mi·ªÖn ph√≠ v√©, ch·ªß ƒë·ªÅ m·ªõi l·∫°, thu h√∫t ·ªü m·ªçi l·ª©a
                                    tu·ªïi...</li>
                                <li><strong>TƒÉng ph√≠ / G√¢y qu·ªπ:</strong> TƒÉng ph√≠ nh·∫π, k√™u g·ªçi t√†i tr·ª£, ƒë√≥ng g√≥p t·ª±
                                    nguy·ªán...</li>
                                <li><strong>M·ªùi kh√°ch m·ªùi:</strong> M·ªùi chuy√™n gia, ng∆∞·ªùi n·ªïi ti·∫øng ƒë·ªÉ tƒÉng s·ª©c h√∫t, c√°c
                                    t√°c ph·∫©m c·ªßa ng∆∞·ªùi ƒë√≥ truy·ªÅn c·∫£m h·ª©ng cho ng∆∞·ªùi y√™u th√≠ch ch·ªß ƒë·ªÅ n√†o ƒë√≥,...
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- B·∫¢NG ƒêI·ªÄU KHI·ªÇN CH·ªåN CH·ª¶ ƒê·ªÄ -->
            <div id="topic-selector-grid" class="topic-grid">
                <!-- C√°c n√∫t ch·ªçn ch·ªß ƒë·ªÅ s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y -->
            </div>

            <main id="writing-container">
                <!-- Ch·ªâ m·ªôt b√†i t·∫≠p ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°i m·ªôt th·ªùi ƒëi·ªÉm -->
            </main>
        </div>
        <footer id="footer-placeholder"></footer>
    </div>
    <script src="js/main.js"></script>
    <script src="js/data-writing-part4.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const selectorContainer = document.getElementById('topic-selector-grid');
            const contentContainer = document.getElementById('writing-container');
            const topics = writingPart4Data;

            topics.forEach((topic, index) => {
                const button = document.createElement('button');
                button.className = 'topic-selector-btn';
                button.textContent = `Ch·ªß ƒë·ªÅ ${index + 1}`;
                button.dataset.target = `#${topic.id}`;
                selectorContainer.appendChild(button);

                const card = document.createElement('div');
                card.className = 'quiz-card writing-part4-card';
                card.id = topic.id;

                // T·∫°o HTML cho g·ª£i √Ω (n·∫øu c√≥)
                let hints1HTML = topic.task1.hints ? '<ul>' + topic.task1.hints.map(h => `<li>${h}</li>`).join('') + '</ul>' : '<p>Kh√¥ng c√≥ g·ª£i √Ω cho ph·∫ßn n√†y.</p>';
                let hints2HTML = topic.task2.hints ? '<ul>' + topic.task2.hints.map(h => `<li>${h}</li>`).join('') + '</ul>' : '<p>Kh√¥ng c√≥ g·ª£i √Ω cho ph·∫ßn n√†y.</p>';

                card.innerHTML = `
                    <div class="card-header"><h2>${topic.title}</h2></div>
                    <div class="context-box">
                        <p>${topic.context}</p>
                        <div class="translation-controls">
                            <button class="action-btn-small show-translation-btn">üîç D·ªãch & T·ª´ kh√≥a</button>
                        </div>
                        <div class="translation-content" style="display:none;">
                            <p><strong>B·∫£n d·ªãch:</strong> ${topic.context_vi || 'Ch∆∞a c√≥ b·∫£n d·ªãch.'}</p>
                            <div class="keywords-list"></div>
                        </div>
                    </div>
                    <!-- Nhi·ªám v·ª• 1 -->
                    <div class="writing-task" data-task-id="1">
                        <div class="task-header"><h3>Nhi·ªám v·ª• 1: Email cho b·∫°n (th√¢n m·∫≠t)</h3><p class="instruction">${topic.task1.instruction}</p></div>
                        <div class="writing-timer-bar"><button class="action-btn start-writing-btn" data-duration="600">B·∫Øt ƒë·∫ßu (10 ph√∫t)</button><div class="timer-display">10:00</div></div>
                        <textarea class="writing-textarea" data-limit="75" rows="8" placeholder="Vi·∫øt email cho b·∫°n c·ªßa b·∫°n ·ªü ƒë√¢y..."></textarea>
                        <div class="word-count-container"><span class="word-count">0/75 words</span></div>
                        <div class="card-actions">
            <!-- CH·ªà C√íN M·ªòT N√öT DUY NH·∫§T -->
            <button class="action-btn show-support-btn">üí° Xem G·ª£i √Ω & ƒê√°p √°n</button>
        </div>
        <!-- G·ªòP HINTS V√Ä SAMPLE ANSWER V√ÄO C√ôNG M·ªòT WRAPPER -->
        <div class="support-wrapper" style="display: none;">
            <div class="hints-wrapper"><h4>G·ª£i √Ω:</h4>${hints1HTML}</div>
            <div class="sample-answer-wrapper"><div class="sample-answer"><pre>${topic.task1.sampleAnswer}</pre></div></div>
        </div>
    </div>
                    <!-- Nhi·ªám v·ª• 2 -->
                    <div class="writing-task" data-task-id="2">
                         <div class="task-header"><h3>Nhi·ªám v·ª• 2: Email cho qu·∫£n l√Ω (trang tr·ªçng)</h3><p class="instruction">${topic.task2.instruction}</p></div>
                         <div class="writing-timer-bar"><button class="action-btn start-writing-btn" data-duration="1200">B·∫Øt ƒë·∫ßu (20 ph√∫t)</button><div class="timer-display">20:00</div></div>
                         <textarea class="writing-textarea" data-limit="225" rows="15" placeholder="Vi·∫øt email cho qu·∫£n l√Ω ·ªü ƒë√¢y..."></textarea>
                         <div class="word-count-container"><span class="word-count">0/225 words</span></div>
                         <div class="card-actions">
            <button class="action-btn show-support-btn">üí° Xem G·ª£i √Ω & ƒê√°p √°n</button>
         </div>
         <div class="support-wrapper" style="display: none;">
            <div class="hints-wrapper"><h4>G·ª£i √Ω:</h4>${hints2HTML}</div>
            <div class="sample-answer-wrapper"><div class="sample-answer"><pre>${topic.task2.sampleAnswer}</pre></div></div>
         </div>
    </div>`;
                contentContainer.appendChild(card);
            });


            const allButtons = selectorContainer.querySelectorAll('.topic-selector-btn');
            const allCards = contentContainer.querySelectorAll('.writing-part4-card');
            let timers = {};

            function showTopic(targetId) {
                allCards.forEach(card => card.classList.remove('active'));
                allButtons.forEach(btn => btn.classList.remove('active'));
                const targetCard = document.querySelector(targetId);
                const targetButton = selectorContainer.querySelector(`[data-target='${targetId}']`);
                if (targetCard) targetCard.classList.add('active');
                if (targetButton) targetButton.classList.add('active');
                Object.values(timers).forEach(timer => clearInterval(timer));
                allCards.forEach(c => {
                    c.querySelectorAll('.writing-timer-bar').forEach(bar => {
                        const btn = bar.querySelector('.start-writing-btn');
                        const display = bar.querySelector('.timer-display');
                        const duration = btn.dataset.duration;
                        const minutes = Math.floor(duration / 60);
                        display.textContent = `${minutes.toString().padStart(2, '0')}:00`;
                        btn.disabled = false;
                        btn.textContent = `B·∫Øt ƒë·∫ßu (${minutes} ph√∫t)`;
                    });
                });
            }

            function loadAnswers(card) {
                const storageKey = `writing_part4_${card.id}`;
                const saved = JSON.parse(localStorage.getItem(storageKey));
                if (saved) {
                    const task1Textarea = card.querySelector('[data-task-id="1"] textarea');
                    const task2Textarea = card.querySelector('[data-task-id="2"] textarea');
                    if (task1Textarea && saved.task1) {
                        task1Textarea.value = saved.task1;
                        task1Textarea.dispatchEvent(new Event('input'));
                    }
                    if (task2Textarea && saved.task2) {
                        task2Textarea.value = saved.task2;
                        task2Textarea.dispatchEvent(new Event('input'));
                    }
                }
            }
            allCards.forEach(loadAnswers);

            selectorContainer.addEventListener('click', function (e) { if (e.target.classList.contains('topic-selector-btn')) showTopic(e.target.dataset.target); });

            contentContainer.addEventListener('input', function (e) {
                if (e.target.classList.contains('writing-textarea')) {
                    const textarea = e.target;
                    const wordCountSpan = textarea.nextElementSibling.querySelector('.word-count');
                    const words = textarea.value.trim().split(/\s+/).filter(word => word.length > 0);
                    const limit = textarea.dataset.limit;
                    wordCountSpan.textContent = `${words.length}/${limit} words`;
                    wordCountSpan.classList.toggle('limit-exceeded', words.length > limit);

                    const card = e.target.closest('.writing-part4-card');
                    const storageKey = `writing_part4_${card.id}`;
                    const task1Value = card.querySelector('[data-task-id="1"] textarea').value;
                    const task2Value = card.querySelector('[data-task-id="2"] textarea').value;
                    localStorage.setItem(storageKey, JSON.stringify({ task1: task1Value, task2: task2Value }));
                }
            });

            contentContainer.addEventListener('click', function (e) {

                // Thay th·∫ø to√†n b·ªô logic c≈© cho n√∫t D·ªãch v√† T·ª´ kh√≥a b·∫±ng ƒëo·∫°n n√†y
                if (e.target.classList.contains('show-translation-btn')) {
                    const button = e.target;
                    const card = button.closest('.writing-part4-card');
                    const topicData = topics.find(t => t.id === card.id);
                    const translationContent = card.querySelector('.translation-content');
                    const keywordsList = translationContent.querySelector('.keywords-list');

                    const isVisible = translationContent.style.display === 'block';

                    if (!isVisible) {
                        // N·∫øu ch∆∞a hi·ªán, th√¨ t·∫°o danh s√°ch t·ª´ kh√≥a tr∆∞·ªõc khi hi·ªÉn th·ªã
                        keywordsList.innerHTML = ''; // X√≥a n·ªôi dung c≈©
                        if (topicData.keywords_vi) {
                            keywordsList.innerHTML = '<h4>T·ª´ kh√≥a ch√≠nh:</h4>';
                            for (const [en, vi] of Object.entries(topicData.keywords_vi)) {
                                keywordsList.innerHTML += `<p><strong>${en}:</strong> ${vi}</p>`;
                            }
                        }
                    }

                    // Hi·ªÉn th·ªã ho·∫∑c ·∫©n to√†n b·ªô khu v·ª±c
                    translationContent.style.display = isVisible ? 'none' : 'block';
                    button.textContent = isVisible ? 'üîç D·ªãch & T·ª´ kh√≥a' : 'üôà ·∫®n';
                }
                if (e.target.classList.contains('start-writing-btn')) {
                    const button = e.target;
                    const timerBar = button.closest('.writing-timer-bar');
                    const timerDisplay = timerBar.querySelector('.timer-display');
                    const taskContainer = button.closest('.writing-task');
                    const textarea = taskContainer.querySelector('.writing-textarea');
                    const timerId = taskContainer.id;

                    if (timers[timerId]) clearInterval(timers[timerId]);
                    button.disabled = true;
                    button.textContent = 'ƒêang t√≠nh gi·ªù...';
                    let timeInSeconds = parseInt(button.dataset.duration, 10);

                    timers[timerId] = setInterval(() => {
                        timeInSeconds--;
                        const minutes = Math.floor(timeInSeconds / 60);
                        const seconds = timeInSeconds % 60;
                        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        if (timeInSeconds <= 0) {
                            clearInterval(timers[timerId]);
                            timerDisplay.textContent = "H·∫øt gi·ªù!";
                            alert(`H·∫øt gi·ªù cho nhi·ªám v·ª• n√†y!`);
                            textarea.disabled = true;
                        }
                    }, 1000);
                }
                // Thay th·∫ø to√†n b·ªô logic c≈© cho n√∫t show-sample-btn v√† show-hints-btn b·∫±ng ƒëo·∫°n n√†y
                if (e.target.classList.contains('show-support-btn')) {
                    const button = e.target;
                    const wrapper = button.closest('.card-actions').nextElementSibling;
                    const isVisible = wrapper.style.display === 'block';

                    wrapper.style.display = isVisible ? 'none' : 'block';
                    button.textContent = isVisible ? 'üí° Xem G·ª£i √Ω & ƒê√°p √°n' : 'üôà ·∫®n G·ª£i √Ω & ƒê√°p √°n';
                }
            });

            if (allButtons.length > 0) showTopic(allButtons[0].dataset.target);
        });
    </script>
</body>

</html>